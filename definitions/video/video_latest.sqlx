config {
    type: "incremental",
    uniqueKey: ['video_id'],
    tags: ["standard"],
    dependencies: ["video"]
}

with latest as (
  select *
  from video
${ when(incremental(), `where updated > (select max(updated) from ${self()})`)}
    qualify row_number() over (partition by video_id order by updated desc)=1
)
select *
from latest

post_operations {
  alter table ${self()} cluster by (channel_id, video_id)
}